<style>
  html { margin: 2rem; }
  body { max-width: 75ch; }
  textarea {
    all: unset;
    width: 100%;
    min-height: 100px;
    word-wrap: break-word;
  }

  textarea:hover,
  textarea:focus {
    background: whitesmoke;
    box-shadow: 0 0 0 10px whitesmoke;
  }
</style>

<App/>

<script>
const App = document.querySelector('App')

const posts = [
  {
    author: `Jamie Wilson`,
    title: `Javascript's Awesome`,
    body: `Sed posuere consectetur est at lobortis. Sed posuere consectetur est at lobortis. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Nullam quis risus eget urna mollis ornare vel eu leo. Vivamus laoreet rutrum faucibus dolor auctor.`
  },
  {
    author: `Chris Coyier`,
    title: `Another CSS Trick`,
    body: `Etiam porta sem malesuada magna mollis euismod. Duis mollis, est non commodo luctus, nisi erat porttitor ligula, eget lacinia odio sem nec elit. Sed posuere consectetur est at lobortis. Vestibulum id ligula porta felis.`
  },
  {
    author: `Bob Saget`,
    title: `A Home Video`,
    body: `Nulla vitae elit libero, a pharetra augue. Aenean lacinia bibendum nulla sed consectetur. Morbi leo risus, porta ac consectetur ac, vestibulum at eros. Maecenas sed diam eget risus varius blandit sit amet non magna. Vestibulum id ligula porta felis.`
  }
]

document.registry = { }
document.id = 0

class Component {
  constructor() {
    this._id = ++document.id
    document.registry[this._id] = this
  }
}

class Post extends Component {
  constructor(props) {
    super()
    this.state = {
      author: props.author,
      title: props.title,
      body: props.body
    }
  }

  render() {
    console.log(this)
    return `<article data-id="${this._id}">
              <h1>${this.state.title}</h1>
              <h5>By ${this.state.author}</h5>
              <textarea maxlength="500"
                onchange="document.registry[${this._id}].save(this.value.trim())"
                spellcheck="false"
              >${this.state.body}</textarea>
            </article>`
  }

  save(body) {
    this.state.body = body
    const self = this
    rerender(self)

  }
}

const rerender = (self) => {
 App.querySelector(`[data-id="${self._id}"]`).outerHTML = self.render()
 setHeight()
}

const setHeight = () => {
  App.querySelectorAll('textarea').forEach(el => {
    el.style.height = el.scrollHeight
  })
}

// Using Array.forEach()
const render = () => {
  posts.forEach((post, i) => {
    posts[i] = new Post(posts[i])
    App.innerHTML += posts[i].render()
    setHeight()
  })
}

// Using Array.map()
const renderUsingArrayMap = () => {
  App.innerHTML = posts.map((post, i) => {
    posts[i] = new Post(posts[i])
    return posts[i].render()
  }).join('')
}

render()
</script>


